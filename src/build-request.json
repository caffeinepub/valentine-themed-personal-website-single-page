{
  "kind": "build_request",
  "title": "Fix Draft Version 7 errors (TypeScript + runtime + asset health-check)",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-15",
      "text": "Fix all TypeScript/compile-time errors in Draft Version 7 so the frontend builds successfully.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "Fix all the errors from the draft"
        ]
      },
      "acceptanceCriteria": [
        "`frontend` TypeScript compilation succeeds with no errors (e.g., `npm run build` / equivalent build step completes).",
        "No TS errors remain related to React type usage in event handlers (e.g., avoid using `React.ChangeEvent` without importing the `React` namespace under the automatic JSX runtime)."
      ]
    },
    {
      "id": "REQ-16",
      "text": "Fix runtime errors and edge cases in the Memories gallery and Edit Panel so the app never crashes if `images`, `memoryCaptions`, or `reasons` arrays are shorter/longer than expected (including avoiding negative-length array creation and out-of-bounds indexing).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "Fix all the errors from the draft"
        ]
      },
      "acceptanceCriteria": [
        "The Memories gallery renders without throwing if `images.length` is not exactly 6 (including when `images.length > 6`), and still displays 6 tiles.",
        "The Edit Panel renders without throwing if `memoryCaptions.length` is not exactly 6, and caption inputs remain usable.",
        "No console errors caused by array length calculations or undefined indexing during normal interaction (open editor, add/remove reasons, open lightbox)."
      ]
    },
    {
      "id": "REQ-17",
      "text": "Ensure the production asset smoke-check and its failure UI do not produce false negatives due to pathing or missing assets, and that the app loads normally when all required static assets exist under `frontend/public/assets/`.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "Fix all the errors from the draft"
        ]
      },
      "acceptanceCriteria": [
        "When the required assets documented in `frontend/DEPLOYMENT.md` are present, the asset smoke-check passes and the Valentine SPA renders (no Deployment Health overlay).",
        "If an asset is genuinely missing, the Deployment Health overlay lists the failing asset URLs and groups without crashing the app.",
        "Asset URLs used by the smoke-check match the appâ€™s deployed site-root pathing conventions (root-absolute `/assets/...`), preventing broken images due to relative paths."
      ]
    }
  ],
  "constraints": [
    "Do not edit files in `frontend/src/components/ui` (compose existing shadcn components instead).",
    "Do not edit immutable hook/bootstrap files: `frontend/src/hooks/useInternetIdentity.ts`, `frontend/src/hooks/useInternetIdentity.tsx`, `frontend/src/hooks/useActor.ts`, `frontend/src/main.tsx`.",
    "Keep the backend as a single Motoko actor; no backend changes are required for this fix unless a frontend error is proven to originate from backend bindings."
  ],
  "nonGoals": [
    "Adding new site sections or new personalization features beyond fixing Draft Version 7 errors.",
    "Publishing/go-live deployment work (this request is limited to fixing draft errors).",
    "Changing the Valentine visual theme or rewriting content copy except where necessary to resolve user-facing error text issues."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}